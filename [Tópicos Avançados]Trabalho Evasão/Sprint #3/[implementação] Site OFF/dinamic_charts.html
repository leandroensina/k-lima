<html>
    <head>

        <title>Controle de Evasão</title>

        <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="favicon/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
        <link rel="manifest" href="favicon/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">

        <!-- JQuery JavaScript 2.2.2 -->
        <script type="text/javascript" src="jquery/2.2.2/js/jquery.js"></script>

        <!-- Bootstrap 3.3.6 -->
        <link rel="stylesheet" href="bootstrap/3.3.6/css/bootstrap.min.css">
        <link rel="stylesheet" href="bootstrap/3.3.6/css/bootstrap-theme.min.css">
        <script src="bootstrap/3.3.6/js/bootstrap.min.js"></script>

        <!-- Awesome tables -->
        <script src="https://awesome-table.com/AwesomeTableInclude.js"></script>

        <!-- My style -->
        <link rel="stylesheet" type="text/css" href="CSS/style.css"/>
        <link rel="stylesheet" type="text/css" href="CSS/map.css"/>

        <!-- My JS -->
        <script src="JS/functions.js"></script>


        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
             var data;
             var chart;

              // Load the Visualization API and the piechart package.
              google.charts.load('current', {'packages':['corechart']});

              // Set a callback to run when the Google Visualization API is loaded.
              google.charts.setOnLoadCallback(drawSheetName);

              // Callback that creates and populates a data table,
              // instantiates the pie chart, passes in the data and
              // draws it.


            function drawSheetName(String) {
              var queryString = encodeURIComponent(String);

              var query = new google.visualization.Query(
                  'https://docs.google.com/spreadsheets/d/1_X3izuFEPmm5-O8h2t5MeT-TJHCvgeUi5ucxjnldWyE/gviz/tq?sheet=Sheet1&headers=1&tq=' + queryString);
              query.send(handleSampleDataQueryResponse);
            }

            function handleSampleDataQueryResponse(response) {
              if (response.isError()) {
                alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
              }

              var data = response.getDataTable();
              var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
              chart.draw(data, { height: 400 });
            }
        </script>

        <script>
            function showChart(){
                var filtPri = document.getElementById("fil_pri").value;
                var tipo_grafico = document.getElementById("tip_graf").value;
                var curso = document.getElementById("curso").value;
                var sit_atual = document.getElementById("sit_atual").value;;
                var ano_let = document.getElementById("ano_let").value;;
                var ano_inic = document.getElementById("ano_inic").value;;
                var ano_fin = document.getElementById("ano_fin").value;;


                var grafico = "SELECT " + filtPri + ", COUNT(A) ";

                    grafico = grafico + "WHERE "

                if (curso != "null")
                    var grafico = grafico + "B = " + "'" + curso + "' AND ";
                
                if (sit_atual != "null")
                    var grafico = grafico + "C = " + "'" + sit_atual + "' AND ";

                if (ano_let != "null")
                    var grafico = grafico + "D = " + "" + ano_let + " AND ";

                if (ano_inic != "null")
                    var grafico = grafico + "E >= " + "" + ano_inic + " AND ";

                if (ano_fin != "null")
                    var grafico = grafico + "E <= " + "" + ano_fin + " AND ";

                    grafico = grafico + "'1' = '1' "

                grafico = grafico + "GROUP BY " + filtPri + " LABEL COUNT(A) 'Quantidade de Alunos'"

                drawSheetName(grafico)

                if(document.getElementById("chart_div").style.display=="none"){
                    document.getElementById("chart_div").style.display="block";
                 }

            }
        </script>

    </head>
 
    <body>
        <nav class="navbar navbar-default navbar-static-top">
          <div class="container"> 
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html"><img src="favicon/ms-icon-310x310.png" class="icon_g"></img>Controle de Evasão</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="charts.html">Gráficos</a></li>
                <li class="active"><a href="dinamic_charts.html">Gráficos Dinânicos</a></li>
            
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </nav>

        <div class="map_div">
            <br>
            <br>
             Filtro Primario:
                    <select name="Filtro Primario" id="fil_pri">
                        <option value="B">Curso</option>
                        <option value="C">Situação Atual</option>
                        <option value="D">Ano letivo</option>
                        <option value="E">Ano de entrada</option>
                    </select>

                    Tipo do Gráfico
                    <select name="Tipo do Gráfico" id="tip_graf">
                        <option value="Column">Colunas</option>
                        <option value="Pie">Pizza</option>
                    </select>

                    <br>
                    <br>
                    Curso:
                    <select name="Curso" id="curso">
                        <option value="null"></option>
                        <option value="Ciência da Computação">Ciência da Computação</option>
                        <option value="Engenharia Elétrica">Engenharia Elétrica</option>
                        <option value="Engenharia Mecânica">Engenharia Mecânica</option>
                        <option value="Matemática">Matemática</option>
                    </select>

                    Situação Atual:
                    <select name="Situação Atual" id="sit_atual">
                        <option value="null"></option>
                        <option value="Formado">Formados</option>
                        <option value="Desistente">Desistentes</option>
                        <option value="Transferido">Transferidos</option>
                        <option value="Cursando">Cursando</option>
                        <option value="Trancado">Trancado</option>
                    </select>

                    Ano Letivo:
                    <select name="Ano Letivo" id="ano_let">
                        <option value="null"></option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>

                    Ano Inicial
                    <select name="Ano Inicial" id="ano_inic">
                        <option value="null"></option>
                        <option value="1995">1995</option>
                        <option value="1996">1996</option>
                        <option value="1997">1997</option>
                        <option value="1998">1998</option>
                        <option value="1999">1999</option>
                        <option value="2000">2000</option>
                        <option value="2001">2001</option>
                        <option value="2002">2002</option>
                        <option value="2003">2003</option>
                        <option value="2004">2004</option>
                        <option value="2005">2005</option>
                        <option value="2006">2006</option>
                        <option value="2007">2007</option>
                        <option value="2008">2008</option>
                        <option value="2009">2009</option>
                        <option value="2010">2010</option>
                        <option value="2011">2011</option>
                        <option value="2012">2012</option>
                        <option value="2013">2013</option>
                        <option value="2014">2014</option>
                        <option value="2015">2015</option>
                        <option value="2016">2016</option>
                    </select>

                    Ano Final
                    <select name="Ano Final" id="ano_fin">
                        <option value="null"></option>
                        <option value="1995">1995</option>
                        <option value="1996">1996</option>
                        <option value="1997">1997</option>
                        <option value="1998">1998</option>
                        <option value="1999">1999</option>
                        <option value="2000">2000</option>
                        <option value="2001">2001</option>
                        <option value="2002">2002</option>
                        <option value="2003">2003</option>
                        <option value="2004">2004</option>
                        <option value="2005">2005</option>
                        <option value="2006">2006</option>
                        <option value="2007">2007</option>
                        <option value="2008">2008</option>
                        <option value="2009">2009</option>
                        <option value="2010">2010</option>
                        <option value="2011">2011</option>
                        <option value="2012">2012</option>
                        <option value="2013">2013</option>
                        <option value="2014">2014</option>
                        <option value="2015">2015</option>
                        <option value="2016">2016</option>
                    </select>

                    <br>
                    <br>

                    <button type="button"  onclick="showChart()"> Gerar </button>
            <div class="dl-card mdl-shadow--4dp">

                    <div id="chart_div" style="display:none"></div>
            
            </div>
        </div>

        <script>
            $(document).on('click','.navbar-collapse.in',function(e) {
                if( $(e.target).is('a') && $(e.target).attr('class') != 'dropdown-toggle' ) {
                    $(this).collapse('hide');
                }
            });
        </script>

    </body>
</html>