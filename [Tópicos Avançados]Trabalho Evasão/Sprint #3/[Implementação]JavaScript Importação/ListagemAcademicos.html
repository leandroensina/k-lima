<html>
  <head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="https://code.jquery.com/jquery-3.0.0-alpha1.js"></script>
  </head>

  <body>
    <input type="file" id="inputCSV" onchange="pegaCSV(this)">

    <form id="form">
      
      <button type="submit">Send</button>
    </form>
    <script>
      


      var leitorDeCSV = new FileReader()
      window.onload = function init() {
        leitorDeCSV.onload = leCSV;
       }

      function pegaCSV(inputFile) {
        var file = inputFile.files[0];
        leitorDeCSV.readAsText(file);
       }
      
    /*
          Colunas relevantes:
            03: Curso
            14: Ano Letivo
            18: Situacao Atual
            19: Nome
            26: Ano Entrada
      */
var strDiv = '';
      leCSV = function(evt){

        //fileArr sao as linhas do arquivo
        var fileArr = evt.target.result.split('\n');
        

        var curso;
        var anoLetivo;
        var situacaoAtual;
        var nome;
        var anoEntrada;
        var CSVsaida = $('#form');
  
        for (var i = 1; i < 15; i++) {
          
          
          var fileLine = fileArr[i].split(';')  ;

          for (var j = 0; j < fileLine.length; j++) {
            if(j == 3){
              curso = fileLine[j].trim();
              strDiv += "<input name='Curso' value='" + curso + "'>";
             }

            if(j == 14){
              anoLetivo = fileLine[j].trim();
              strDiv += "<input name='Ano_letivo' value='" + anoLetivo + "'>";
             }

            if(j == 18){
              situacaoAtual = fileLine[j].trim();
              strDiv += "<input name='Situacao_atual' value='" + situacaoAtual + "'>";
             }

            if(j == 19){
              nome = fileLine[j].trim();
                strDiv += "<input name='Nome' value='" + nome + "'>";
             }

            if(j == 26){
              anoEntrada = fileLine[j].trim();
              strDiv += "<input name='Ano_de_entrada' value='" + anoEntrada + "'>";
             }
              
           }//for colun

                   
         }//for linha
          CSVsaida.append(strDiv);
          //CSVsaida.submit();
       }

   var sheetsuUrl = "https://sheetsu.com/apis/v1.0/7f21ab898df9";
      (function ($) {
        var aux;
        $.fn.serializeFormJSON = function () {
          var o = {};          
          var a = this.serializeArray();
          $.each(a, function () {
            if (o[this.name]) {

              if (!o[this.name].push) {
               o[this.name] = [o[this.name]]; 
               }
              o[this.name].push(this.value || '');              
            }
             else {
              o[this.name] = this.value || ''; 
            }
            
          });
          console.log("--------");
          console.log(o);
          console.log(o.Nome[0]);
          console.log(o.Curso[0]);
          console.log(o.Situacao_atual[0]);
          console.log(o.Ano_de_entrada[0]);
          console.log(o.Ano_letivo[0]);
          console.log("--------");
          return o;
        };
      })(jQuery);

      $('#form').submit(function(e) {
        // prevent default submiting form
        e.preventDefault();

        // serialize data to JSON
        var data = $('#form').serializeFormJSON();

        $.ajax({
          url: sheetsuUrl,
          data: data,
          dataType: 'json',
          type: 'POST',

          // place for handling successful response
          // showing (redirecting to) something like /thanks.html
          // page could be a good idea
          success: function(data) {
            //window.alert(data);
            console.log(data);
          },

          // handling error response
          error: function(data) {
            //window.alert(data);
            console.log(data);
          }
        });

        return false;
      });
    </script>

  </body>

  <!-- http://tableless.com.br/file-api-trabalhando-com-arquivos-locais-usando-javascript/ -->

</html>
