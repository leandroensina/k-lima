<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  </head>

  <body>

    <input type="file" id="inputCSV" onchange="pegaCSV(this)">
    <div id="CSVsaida"></div>

    <script>

      var leitorDeCSV = new FileReader()
        window.onload = function init() {
          leitorDeCSV.onload = leCSV;
        }

        function pegaCSV(inputFile) {
          var file = inputFile.files[0];
          leitorDeCSV.readAsText(file);
        }

      /*
          Tendo um array de uma dimensao, a cconta para acessar a posicao da tabela se da por:
                                    17*L+C+L
          onde,
            L: Linha
            C: Coluna
            17: numero total de colunas (na verdade vai de 0 a 17)

          Colunas relevantes:
            10: Ano
            12: Descricao da Materia
            13: Total de Reprovados
            14: Total de Aprovados
            16: Porcentacem de Aprovados
            17: Porcentagem de Reprovados
      */
      function leCSV(evt){
        //fileArr sao as linhas do arquivo
        var fileArr = evt.target.result.split('\n');

        var sheetsuUrl = "";

        var CSVsaida_aux = $('#CSVsaida');

        for (var i = 1; i < fileArr.length - 1; i++) {
          var strDiv = '<form id="form">\n';
          var fileLine = fileArr[i].split(';');

          var ano = fileLine[10].trim();
          var materia = fileLine[12].trim();
          var totalReprovados = fileLine[13].trim();
          var totalAprovados = fileLine[14].trim();
          var porcentagemAprovados = fileLine[16].trim();
          var porcentagemReprovados = fileLine[17].trim();

          strDiv += ' <input type="text" name="Ano" value="' + ano + '">\n';
          strDiv += ' <input type="text" name="Materia" value="' + materia + '">\n';
          strDiv += ' <input type="text" name="Total_Reprovados" value="' + totalReprovados + '">\n';
          strDiv += ' <input type="text" name="Total_Aprovados" value="' + totalAprovados + '">\n';
          strDiv += ' <input type="text" name="Porcentagem_Aprovados" value="' + porcentagemAprovados + '">\n';
          strDiv += ' <input type="text" name="Porcentagem_Reprovados" value="' + porcentagemReprovados + '">\n';

          strDiv += '</form>';

          console.log('::Iteracao: ' + i + ':\n' + strDiv);

          var CSVsaida = document.getElementById('CSVsaida');
          CSVsaida.innerHTML = strDiv;

          // jQuery snippet for changing HTML form into JSON
          (function ($) {
            $.fn.serializeFormJSON = function () {
              var o = {};
              var a = this.serializeArray();
              $.each(a, function () {
                if (o[this.name]) {
                  if (!o[this.name].push) { o[this.name] = [o[this.name]]; }
                  o[this.name].push(this.value || '');
                } else { o[this.name] = this.value || ''; }
              });
              return o;
            };
          })(jQuery);

          // serialize data to JSON
          var data = $('#form').serializeFormJSON();

          $.ajax({
            url: 'https://sheetsu.com/apis/v1.0/d821045b709a',
            data: data,
            dataType: 'json',
            type: 'POST',

            // place for handling successful response
            // showing (redirecting to) something like /thanks.html
            // page could be a good idea
            success: function(data) {
              //window.location.href = 'thank_you.html';
              console.log('Sucesso!');
              console.log(data);
            },

            // handling error response
            error: function(data) {
              console.log(data);
            }
          });
        }
      }

    

    /*
    $('#form').submit(function(e) {
      

      return false;
    });
    */
  </script>
  </body>
</html>