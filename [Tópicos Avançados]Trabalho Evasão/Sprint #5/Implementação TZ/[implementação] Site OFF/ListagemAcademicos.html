<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  </head>

  <body>

    <input type="file" id="inputCSV" onchange="pegaCSV(this)">
    <div id="CSVsaida"></div>

    <script>

      var leitorDeCSV = new FileReader()
        window.onload = function init() {
          leitorDeCSV.onload = leCSV;
        }

        function pegaCSV(inputFile) {
          var file = inputFile.files[0];
          leitorDeCSV.readAsText(file);
        }

      /*
          Tendo um array de uma dimensao, a cconta para acessar a posicao da tabela se da por:
                                    17*L+C+L
          onde,
            L: Linha
            C: Coluna
            17: numero total de colunas (na verdade vai de 0 a 17)

          Colunas relevantes:
            03: Curso
            14: Ano Letivo
            18: Situacao Atual
            19: Nome
            26: Ano Entrada
      */
      function leCSV(evt){
        //fileArr sao as linhas do arquivo
        var fileArr = evt.target.result.split('\n');

        var sheetsuUrl = "";

        var CSVsaida_aux = $('#CSVsaida');

        for (var i = 1; i < fileArr.length - 1; i++) {
          var strDiv = '<form id="form">\n';
          var fileLine = fileArr[i].split(';');

          var curso = fileLine[3].trim();
          var anoLetivo = fileLine[14].trim();
          var situacaoAtual = fileLine[18].trim();
          var nome = fileLine[19].trim();
          var anoEntrada = fileLine[26].trim();
          
          strDiv += ' <input type="text" name="Nome" value="' + nome + '">\n';
          strDiv += ' <input type="text" name="Curso" value="' + curso + '">\n';
          strDiv += ' <input type="text" name="Situacao_atual" value="' + situacaoAtual + '">\n';
          strDiv += ' <input type="text" name="Ano_letivo" value="' + anoLetivo + '">\n';
          strDiv += ' <input type="text" name="Ano_de_entrada" value="' + anoEntrada + '">\n';
       
          strDiv += '</form>';

          console.log('::Iteracao: ' + i + ':\n' + strDiv);

          var CSVsaida = document.getElementById('CSVsaida');
          CSVsaida.innerHTML = strDiv;

          // jQuery snippet for changing HTML form into JSON
          (function ($) {
            $.fn.serializeFormJSON = function () {
              var o = {};
              var a = this.serializeArray();
              $.each(a, function () {
                if (o[this.name]) {
                  if (!o[this.name].push) { o[this.name] = [o[this.name]]; }
                  o[this.name].push(this.value || '');
                } else { o[this.name] = this.value || ''; }
              });
              return o;
            };
          })(jQuery);

          // serialize data to JSON
          var data = $('#form').serializeFormJSON();

          $.ajax({
            url: 'https://sheetsu.com/apis/v1.0/c890f06e6965',
            data: data,
            dataType: 'json',
            type: 'POST',

            // place for handling successful response
            // showing (redirecting to) something like /thanks.html
            // page could be a good idea
            success: function(data) {
              //window.location.href = 'thank_you.html';
              console.log('Sucesso!');
            },

            // handling error response
            error: function(data) {
              console.log(data);
            }
          });
        }
        
        //CSVsaida_aux.submit();
      }

    

    /*
    $('#form').submit(function(e) {
      

      return false;
    });
    */
  </script>
  </body>
</html>